
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
      <link rel="shortcut icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.1.2, mkdocs-material-6.2.5">
    
    
      
        <title>/hardware - OTCamera API Documentation</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.15aa0b43.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.75751829.min.css">
        
      
    
    
    
      
    
    
    
    
      
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="slate" data-md-color-primary="" data-md-color-accent="">
      
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#hardware_1" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid" aria-label="Header">
    <a href=".." title="OTCamera API Documentation" class="md-header-nav__button md-logo" aria-label="OTCamera API Documentation">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path fill-rule="evenodd" d="M24 5.25a.75.75 0 00-1.136-.643L16.5 8.425V6.25a1.75 1.75 0 00-1.75-1.75h-13A1.75 1.75 0 000 6.25v11C0 18.216.784 19 1.75 19h13a1.75 1.75 0 001.75-1.75v-2.175l6.364 3.818A.75.75 0 0024 18.25v-13zm-7.5 8.075l6 3.6V6.575l-6 3.6v3.15zM15 9.75v-3.5a.25.25 0 00-.25-.25h-13a.25.25 0 00-.25.25v11c0 .138.112.25.25.25h13a.25.25 0 00.25-.25v-7.5z"/></svg>

    </a>
    <label class="md-header-nav__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header-nav__title" data-md-component="header-title">
      <div class="md-header-nav__ellipsis">
        <div class="md-header-nav__topic">
          <span class="md-ellipsis">
            OTCamera API Documentation
          </span>
        </div>
        <div class="md-header-nav__topic">
          <span class="md-ellipsis">
            
              /hardware
            
          </span>
        </div>
      </div>
    </div>
    
      <label class="md-header-nav__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" data-md-component="search-reset" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header-nav__source">
        
<a href="https://github.com/OpenTrafficCam/OTCamera/" title="Go to repository" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    OpenTrafficCam/OTCamera
  </div>
</a>
      </div>
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    




  

<nav class="md-nav md-nav--primary md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="OTCamera API Documentation" class="md-nav__button md-logo" aria-label="OTCamera API Documentation">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path fill-rule="evenodd" d="M24 5.25a.75.75 0 00-1.136-.643L16.5 8.425V6.25a1.75 1.75 0 00-1.75-1.75h-13A1.75 1.75 0 000 6.25v11C0 18.216.784 19 1.75 19h13a1.75 1.75 0 001.75-1.75v-2.175l6.364 3.818A.75.75 0 0024 18.25v-13zm-7.5 8.075l6 3.6V6.575l-6 3.6v3.15zM15 9.75v-3.5a.25.25 0 00-.25-.25h-13a.25.25 0 00-.25.25v11c0 .138.112.25.25.25h13a.25.25 0 00.25-.25v-7.5z"/></svg>

    </a>
    OTCamera API Documentation
  </label>
  
    <div class="md-nav__source">
      
<a href="https://github.com/OpenTrafficCam/OTCamera/" title="Go to repository" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    OpenTrafficCam/OTCamera
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      


  
  
  
    <li class="md-nav__item">
      <a href="../record/" class="md-nav__link">
        record.py
      </a>
    </li>
  

    
      
      
      


  
  
  
    <li class="md-nav__item">
      <a href="../config/" class="md-nav__link">
        config.py
      </a>
    </li>
  

    
      
      
      


  
  
  
    <li class="md-nav__item">
      <a href="../status/" class="md-nav__link">
        status.py
      </a>
    </li>
  

    
      
      
      


  
  
  
    <li class="md-nav__item">
      <a href="../helpers/" class="md-nav__link">
        /helpers
      </a>
    </li>
  

    
      
      
      


  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          /hardware
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        /hardware
      </a>
      
        
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#hardware" class="md-nav__link">
    hardware
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hardware.buttons" class="md-nav__link">
    buttons
  </a>
  
    <nav class="md-nav" aria-label="buttons">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hardware.buttons.its_record_time" class="md-nav__link">
    its_record_time()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hardware.camera" class="md-nav__link">
    camera
  </a>
  
    <nav class="md-nav" aria-label="camera">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hardware.camera.preview" class="md-nav__link">
    preview()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hardware.camera.split_if_interval_ends" class="md-nav__link">
    split_if_interval_ends()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hardware.camera.start_recording" class="md-nav__link">
    start_recording()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hardware.camera.stop_recording" class="md-nav__link">
    stop_recording()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hardware.leds" class="md-nav__link">
    leds
  </a>
  
    <nav class="md-nav" aria-label="leds">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hardware.leds.off" class="md-nav__link">
    off()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hardware.leds.power_on" class="md-nav__link">
    power_on()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hardware.leds.rec_off" class="md-nav__link">
    rec_off()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hardware.leds.rec_on" class="md-nav__link">
    rec_on()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/OpenTrafficCam/OTCamera/edit/master/docs/hardware.md" title="Edit this page" class="md-content__button md-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg>
                  </a>
                
                
                <h1 id="hardware_1">/hardware</h1>
<div class="doc doc-object doc-module">
<h2 class="hidden-toc" id="hardware" style="visibility: hidden; position: absolute;">
        </h2>
<div class="doc doc-contents first">
<div class="doc doc-children">
<div class="doc doc-object doc-module">
<h2 class="doc doc-heading" id="hardware.buttons">

        <code>buttons</code>



      </h2>
<div class="doc doc-contents ">
<p>OTCamera helper to interact with hardware buttons.</p>
<p>Initializes hardware buttons using gpiozero if configured in config.py.
Button callbacks are calling functions in rpi helper</p>
<div class="doc doc-children">
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="hardware.buttons.its_record_time">

<code class="highlight language-python"><span class="n">its_record_time</span><span class="p">()</span></code>


      </h3>
<div class="doc doc-contents ">
<p>Is it time to record or not?</p>
<p>Determines if the current hour is an hour after start hour and before end hour
configured in config.py as long as the hour button is not pressed. If pressed it's
always recording time.</p>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>bool</code></td>
<td>
<p>True if it is recording time</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
          <summary>Source code in <code>hardware/buttons.py</code></summary>
          <div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">its_record_time</span><span class="p">():</span>
    <span class="sd">"""Is it time to record or not?</span>

<span class="sd">    Determines if the current hour is an hour after start hour and before end hour</span>
<span class="sd">    configured in config.py as long as the hour button is not pressed. If pressed it's</span>
<span class="sd">    always recording time.</span>

<span class="sd">    Returns:</span>
<span class="sd">        bool: True if it is recording time</span>
<span class="sd">    """</span>
    <span class="n">current_hour</span> <span class="o">=</span> <span class="n">dt</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">hour</span>
    <span class="n">record_time</span> <span class="o">=</span> <span class="p">(</span>
        <span class="p">(</span><span class="n">hour</span><span class="o">.</span><span class="n">is_pressed</span><span class="p">)</span>
        <span class="ow">or</span> <span class="p">(</span><span class="n">current_hour</span> <span class="o">&gt;=</span> <span class="n">config</span><span class="o">.</span><span class="n">STARTHOUR</span> <span class="ow">and</span> <span class="n">current_hour</span> <span class="o">&lt;</span> <span class="n">config</span><span class="o">.</span><span class="n">ENDHOUR</span><span class="p">)</span>
    <span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="ow">not</span> <span class="n">status</span><span class="o">.</span><span class="n">SHUTDOWNACTIVE</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">record_time</span>
</code></pre>
</div>
</details>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-module">
<h2 class="doc doc-heading" id="hardware.camera">

        <code>camera</code>



      </h2>
<div class="doc doc-contents ">
<p>OTCamera helper to handle picamera interaction.</p>
<p>Used to start, split and stop recording.</p>
<div class="doc doc-children">
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="hardware.camera.preview">

<code class="highlight language-python"><span class="n">preview</span><span class="p">()</span></code>


      </h3>
<div class="doc doc-contents ">
<p>Capture a preview image.</p>
<p>Captures a new preview image, if the current second matches the preview interval
configured in config.py and the Wifi AP is turned on (otherwise, a preview would
be useless).</p>
<details class="quote">
          <summary>Source code in <code>hardware/camera.py</code></summary>
          <div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">preview</span><span class="p">():</span>
    <span class="sd">"""Capture a preview image.</span>

<span class="sd">    Captures a new preview image, if the current second matches the preview interval</span>
<span class="sd">    configured in config.py and the Wifi AP is turned on (otherwise, a preview would</span>
<span class="sd">    be useless).</span>

<span class="sd">    """</span>
    <span class="n">current_second</span> <span class="o">=</span> <span class="n">dt</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">second</span>
    <span class="n">offset</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">PREVIEW_INTERVAL</span> <span class="o">-</span> <span class="mi">1</span>
    <span class="n">preview_second</span> <span class="o">=</span> <span class="p">(</span><span class="n">current_second</span> <span class="o">%</span> <span class="n">config</span><span class="o">.</span><span class="n">PREVIEW_INTERVAL</span><span class="p">)</span> <span class="o">==</span> <span class="n">offset</span>

    <span class="k">if</span> <span class="n">preview_second</span> <span class="ow">and</span> <span class="n">status</span><span class="o">.</span><span class="n">preview_on</span><span class="p">()</span> <span class="ow">and</span> <span class="n">status</span><span class="o">.</span><span class="n">new_preview</span><span class="p">:</span>
        <span class="n">log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">"new preview"</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s2">"debug"</span><span class="p">)</span>
        <span class="n">_capture</span><span class="p">()</span>
        <span class="n">status</span><span class="o">.</span><span class="n">new_preview</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">elif</span> <span class="ow">not</span> <span class="p">(</span><span class="n">preview_second</span> <span class="ow">or</span> <span class="n">status</span><span class="o">.</span><span class="n">new_preview</span><span class="p">):</span>
        <span class="n">log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">"reset new preview"</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s2">"debug"</span><span class="p">)</span>
        <span class="n">status</span><span class="o">.</span><span class="n">new_preview</span> <span class="o">=</span> <span class="kc">True</span>
</code></pre>
</div>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="hardware.camera.split_if_interval_ends">

<code class="highlight language-python"><span class="n">split_if_interval_ends</span><span class="p">()</span></code>


      </h3>
<div class="doc doc-contents ">
<p>Splits the videofile if the configured intervals ends.</p>
<p>An Interval is configured in config.py. If the current minute matches the interval
length, the video file is split and a new file begins.
Counts the full intervals already recorded. If the maximum number of intervals,
configured in config.py is reached, recording stops by breaking the loop in
record.py.</p>
<details class="quote">
          <summary>Source code in <code>hardware/camera.py</code></summary>
          <div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">split_if_interval_ends</span><span class="p">():</span>
    <span class="sd">"""Splits the videofile if the configured intervals ends.</span>

<span class="sd">    An Interval is configured in config.py. If the current minute matches the interval</span>
<span class="sd">    length, the video file is split and a new file begins.</span>
<span class="sd">    Counts the full intervals already recorded. If the maximum number of intervals,</span>
<span class="sd">    configured in config.py is reached, recording stops by breaking the loop in</span>
<span class="sd">    record.py.</span>

<span class="sd">    """</span>
    <span class="k">if</span> <span class="n">_new_interval</span><span class="p">():</span>
        <span class="n">log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">"new interval"</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s2">"debug"</span><span class="p">)</span>
        <span class="n">_split</span><span class="p">()</span>
        <span class="n">status</span><span class="o">.</span><span class="n">interval_finished</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">status</span><span class="o">.</span><span class="n">current_interval</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">config</span><span class="o">.</span><span class="n">N_INTERVALS</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">status</span><span class="o">.</span><span class="n">more_intervals</span> <span class="o">=</span> <span class="n">status</span><span class="o">.</span><span class="n">current_interval</span> <span class="o">&lt;</span> <span class="n">config</span><span class="o">.</span><span class="n">N_INTERVALS</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">status</span><span class="o">.</span><span class="n">more_intervals</span><span class="p">:</span>
            <span class="n">log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">"last interval"</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s2">"debug"</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">_after_new_interval</span><span class="p">():</span>
        <span class="n">status</span><span class="o">.</span><span class="n">interval_finished</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">"reset new interval"</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s2">"debug"</span><span class="p">)</span>
    <span class="n">_wait_recording</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>
</code></pre>
</div>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="hardware.camera.start_recording">

<code class="highlight language-python"><span class="n">start_recording</span><span class="p">()</span></code>


      </h3>
<div class="doc doc-contents ">
<p>Start a recording a video.</p>
<p>If picam isn't already recording:
- Deletes old files, until enough free space is available.
- Starts a new recording on picam, using the config.py.
- Waits 2 seconds and caputres a preview image.
- Turns on the record LED (if attached).</p>
<details class="quote">
          <summary>Source code in <code>hardware/camera.py</code></summary>
          <div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">start_recording</span><span class="p">():</span>
    <span class="sd">"""Start a recording a video.</span>

<span class="sd">    If picam isn't already recording:</span>
<span class="sd">    - Deletes old files, until enough free space is available.</span>
<span class="sd">    - Starts a new recording on picam, using the config.py.</span>
<span class="sd">    - Waits 2 seconds and caputres a preview image.</span>
<span class="sd">    - Turns on the record LED (if attached).</span>

<span class="sd">    """</span>
    <span class="c1"># TODO: exception handling</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">picam</span><span class="o">.</span><span class="n">recording</span><span class="p">:</span>
        <span class="n">delete_old_files</span><span class="p">()</span>
        <span class="n">picam</span><span class="o">.</span><span class="n">annotate_text</span> <span class="o">=</span> <span class="n">name</span><span class="o">.</span><span class="n">annotate</span><span class="p">()</span>
        <span class="n">picam</span><span class="o">.</span><span class="n">start_recording</span><span class="p">(</span>
            <span class="n">output</span><span class="o">=</span><span class="n">name</span><span class="o">.</span><span class="n">video</span><span class="p">(),</span>
            <span class="nb">format</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">FORMAT</span><span class="p">,</span>
            <span class="n">resize</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">RESIZE</span><span class="p">,</span>
            <span class="n">profile</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">PROFILE</span><span class="p">,</span>
            <span class="n">level</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">LEVEL</span><span class="p">,</span>
            <span class="n">bitrate</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">BITRATE</span><span class="p">,</span>
            <span class="n">quality</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">QUALITY</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">"started recording"</span><span class="p">)</span>
        <span class="n">_wait_recording</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">_capture</span><span class="p">()</span>
        <span class="n">leds</span><span class="o">.</span><span class="n">rec_on</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">pass</span>
</code></pre>
</div>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="hardware.camera.stop_recording">

<code class="highlight language-python"><span class="n">stop_recording</span><span class="p">()</span></code>


      </h3>
<div class="doc doc-contents ">
<p>Stops the video recording.</p>
<p>If the picamera is recording, the recording is stopped. Additionally, the record
LED ist switched of (if configured).</p>
<details class="quote">
          <summary>Source code in <code>hardware/camera.py</code></summary>
          <div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">stop_recording</span><span class="p">():</span>
    <span class="sd">"""Stops the video recording.</span>

<span class="sd">    If the picamera is recording, the recording is stopped. Additionally, the record</span>
<span class="sd">    LED ist switched of (if configured).</span>

<span class="sd">    """</span>
    <span class="k">if</span> <span class="n">picam</span><span class="o">.</span><span class="n">recording</span><span class="p">:</span>
        <span class="n">picam</span><span class="o">.</span><span class="n">stop_recording</span><span class="p">()</span>
        <span class="n">leds</span><span class="o">.</span><span class="n">rec_off</span><span class="p">()</span>
        <span class="n">log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">"recorded </span><span class="si">{n}</span><span class="s2"> videos"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="n">status</span><span class="o">.</span><span class="n">current_interval</span><span class="p">))</span>
        <span class="n">log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">"stopped recording"</span><span class="p">)</span>
</code></pre>
</div>
</details>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-module">
<h2 class="doc doc-heading" id="hardware.leds">

        <code>leds</code>



      </h2>
<div class="doc doc-contents ">
<p>OTCamera LED interaction helper.</p>
<p>If LEDs are configured in config.py this modules handels all the interaction (on, off,
blinking) of the LEDs.</p>
<div class="doc doc-children">
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="hardware.leds.off">

<code class="highlight language-python"><span class="n">off</span><span class="p">()</span></code>


      </h3>
<div class="doc doc-contents ">
<p>Turn all LEDs off.</p>
<details class="quote">
          <summary>Source code in <code>hardware/leds.py</code></summary>
          <div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">off</span><span class="p">():</span>
    <span class="sd">"""Turn all LEDs off."""</span>
    <span class="k">if</span> <span class="n">config</span><span class="o">.</span><span class="n">USE_LED</span><span class="p">:</span>
        <span class="n">power</span><span class="o">.</span><span class="n">on</span><span class="p">()</span>
        <span class="n">wifi</span><span class="o">.</span><span class="n">on</span><span class="p">()</span>
        <span class="n">rec</span><span class="o">.</span><span class="n">on</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">pass</span>
</code></pre>
</div>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="hardware.leds.power_on">

<code class="highlight language-python"><span class="n">power_on</span><span class="p">()</span></code>


      </h3>
<div class="doc doc-contents ">
<p>Blink power LED infinite.</p>
<details class="quote">
          <summary>Source code in <code>hardware/leds.py</code></summary>
          <div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">power_on</span><span class="p">():</span>
    <span class="sd">"""Blink power LED infinite."""</span>
    <span class="k">if</span> <span class="n">config</span><span class="o">.</span><span class="n">USE_LED</span><span class="p">:</span>
        <span class="n">power</span><span class="o">.</span><span class="n">blink</span><span class="p">(</span><span class="n">on_time</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">off_time</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">background</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">pass</span>
</code></pre>
</div>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="hardware.leds.rec_off">

<code class="highlight language-python"><span class="n">rec_off</span><span class="p">()</span></code>


      </h3>
<div class="doc doc-contents ">
<p>Pulse record LED 4 times and switch it off.</p>
<details class="quote">
          <summary>Source code in <code>hardware/leds.py</code></summary>
          <div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">rec_off</span><span class="p">():</span>
    <span class="sd">"""Pulse record LED 4 times and switch it off."""</span>
    <span class="k">if</span> <span class="n">config</span><span class="o">.</span><span class="n">USE_LED</span><span class="p">:</span>
        <span class="n">rec</span><span class="o">.</span><span class="n">off</span><span class="p">()</span>
        <span class="n">rec</span><span class="o">.</span><span class="n">pulse</span><span class="p">(</span><span class="n">fade_in_time</span><span class="o">=</span><span class="mf">0.25</span><span class="p">,</span> <span class="n">fade_out_time</span><span class="o">=</span><span class="mf">0.25</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">background</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">pass</span>
</code></pre>
</div>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="hardware.leds.rec_on">

<code class="highlight language-python"><span class="n">rec_on</span><span class="p">()</span></code>


      </h3>
<div class="doc doc-contents ">
<p>Blink record LED infinite.</p>
<details class="quote">
          <summary>Source code in <code>hardware/leds.py</code></summary>
          <div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">rec_on</span><span class="p">():</span>
    <span class="sd">"""Blink record LED infinite."""</span>
    <span class="k">if</span> <span class="n">config</span><span class="o">.</span><span class="n">USE_LED</span><span class="p">:</span>
        <span class="n">rec</span><span class="o">.</span><span class="n">blink</span><span class="p">(</span><span class="n">on_time</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">off_time</span><span class="o">=</span><span class="mf">4.9</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">background</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">pass</span>
</code></pre>
</div>
</details>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
                
                  
                    

<hr>
<div class="md-source-date">
  <small>
    
      Last update: 2021-01-24
    
  </small>
</div>
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid" aria-label="Footer">
        
          <a href="../helpers/" class="md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
            </div>
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                /helpers
              </div>
            </div>
          </a>
        
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            Copyright &copy; 2021 OpenTrafficCam contributors
          </div>
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/vendor.93c04032.min.js"></script>
      <script src="../assets/javascripts/bundle.83e5331e.min.js"></script><script id="__lang" type="application/json">{"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing"}</script>
      
      <script>
        app = initialize({
          base: "..",
          features: ['navigation.sections', 'toc.integrate'],
          search: Object.assign({
            worker: "../assets/javascripts/worker/search.8c7e0a7e.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script>
      
    
  </body>
</html>